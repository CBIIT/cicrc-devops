{
    "family": "cicrc-{{environment}}-web",
    "taskRoleArn": "arn:aws:iam::{{account_id}}:role/power-user-cicrc-{{environment}}-ecs-task-role",
    "executionRoleArn": "arn:aws:iam::{{account_id}}:role/power-user-cicrc-{{environment}}-ecs-task-execution-role",
    "requiresCompatibilities": [
        "FARGATE"
    ],
    "networkMode": "awsvpc",
    "cpu": "1024",
    "memory": "2048",
    "containerDefinitions": [
        {
            "name": "firelens-container",
            "image": "public.ecr.aws/aws-observability/aws-for-fluent-bit:stable",
            "essential": false,
            "cpu": 0,
            "portMappings": [],
            "environment": [],
            "mountPoints": [],
            "volumesFrom": [],
            "user": "0",
            "firelensConfiguration": {
                "type": "fluentbit",
                 "options": {
                    "enable-ecs-log-metadata": "true"
                }
            }
        },
        {
            "name": "web",
            "image": "{{image_id}}",
            "cpu": 0,
            "portMappings": [
                {
                    "name": "web-80-tcp",
                    "containerPort": 80,
                    "hostPort": 80,
                    "protocol": "tcp"
                }
            ],
            "essential": true,
			"mountPoints": [
                {
                    "containerPath": "/var/www/html/web/sites/default/files",
                    "sourceVolume": "cicrc-efs",
                    "readOnly": false
                }
            ],
            "secrets": [
                {
                    "name": "DB_NAME",
                    "valueFrom": "arn:aws:secretsmanager:us-east-1:{{account_id}}:secret:cicrc/db/{{environment}}:DB_NAME::"
                },
                {
                    "name": "DB_PASS",
                    "valueFrom": "arn:aws:secretsmanager:us-east-1:{{account_id}}:secret:cicrc/db/{{environment}}:DB_PASS::"
                },
                {
                    "name": "DB_HOST",
                    "valueFrom": "arn:aws:secretsmanager:us-east-1:{{account_id}}:secret:cicrc/db/{{environment}}:DB_HOST::"
                },
                {
                    "name": "DB_USER",
                    "valueFrom": "arn:aws:secretsmanager:us-east-1:{{account_id}}:secret:cicrc/db/{{environment}}:DB_USER::"
                }
            ],
            "logConfiguration": {
                "logDriver": "awsfirelens",
                "options": {
                  "Format": "json_lines",
                  "Name": "splunk",
                  "Host": "{{splunk_host}}",
                  "Port": "{{splunk_port}}",
                  "Splunk_Token": "{{splunk_token}}",
                  "tls": "on",
                  "tls.verify": "off"
                }
            }
            // "logConfiguration": {
            //     "logDriver": "awslogs",
            //     "options": {
            //         "awslogs-group": "cicrc/ecs/{{environment}}/web",
            //         "awslogs-region": "us-east-1",
            //         "awslogs-stream-prefix": "ecs"
            //     }
            // }
            // "logConfiguration": {
            //     "logDriver": "splunk",
            //     "options": {
            //         "splunk-url": "https://{{splunk_host}}:{{splunk_port}}",
            //         "tag": "crcr-{{environment}}",
            //         "splunk-token":"{{splunk_token}}"
            //     }
            // }
        }
    ],
	"volumes": [
        {
            "name": "cicrc-efs",
            "efsVolumeConfiguration": {
                "fileSystemId": "{{efs_id}}",
                "transitEncryption": "ENABLED"
            }
        },
        {
          "name": "log-volume",
          "host": {
            "sourcePath": "/ecs/logs"
          }
        }
    ]
}